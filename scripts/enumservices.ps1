$VulnServices = gwmi win32_service | ?{$_} | where {($_.pathname -ne $null) -and ($_.pathname.trim() -ne "")} | where {-not $_.pathname.StartsWith("`"")} | where {($_.pathname.Substring(0, $_.pathname.IndexOf(".exe") + 4)) -match ".* .*"}; if ($VulnServices) { foreach ($service in $VulnServices){ $out = New-Object System.Collections.Specialized.OrderedDictionary; $out.add("ServiceName", $service.name); $out.add("Path", $service.pathname); $out } }